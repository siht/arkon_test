version: '3'

services:
  web_service:
    command: uwsgi --socket ${SOCKETS_PATH}/${PROJECT_NAME}.sock --module ${UWSGI_PARENT_MODULE_NAME}.wsgi --uid ${UID_FOR_SOCKETS} --gid ${GID_FOR_SOCKETS}
  server:
    env_file:
        - ".env_shared"
        - ".env_nginx"
    image: "nginx"
    volumes:
      - "data_for_serve:${SERVER_DATA}"
      - "./config/nginx/mysite.template:/etc/nginx/conf.d/mysite.template"
      - "./config/nginx/nginx_conf.template:/etc/nginx/nginx_conf.template"
      - "./config/nginx/entrypoint.sh:/code/entrypoint.sh"
    environment:
      PROJECT_NAME: ${PROJECT_NAME}
      DOLLAR: $$
    working_dir: /code
    command: ["./entrypoint.sh"]
    ports:
      - "${NGINX_OUT_PORT}:${NGINX_INTERNAL_PORT}"
    depends_on:
      - web_service
  pulling_app:
    command: ["./entrypoint.sh"]